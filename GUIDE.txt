
zmake v1.5
=============

Конвертер картинок + сборщик циферблатов\приложений для ZeppOS.

Файлы\папки программе можно передавать через первый параметр командной строки,либо перетаскиванием
на exe-файл. Поведение зависит от того, что вы ей дадите.
- Если дать на вход файл bin, она его распакует и выполнит конвертацию картинок.
- Если дать ан вход пустую папку, развернёт в ней свой шаблон.
- Если дать на вход папку с полноценным приложением\циферблатов, он будет полностью собран воедино,
об этом ниже
- Если дать на вход программе картинку или папку с картинками (assets например), она
конвертирует все картинки. Направление (PNG -> TGA или TGA -> PNG) определяется автоматически,
в случае неопределённости она спросит. В случае если картинки не вписываются в ограничения,
они будут сжаты, а оригиналы сохранены в backups рядом с программой.

Ниже подробнее.

Конвертация графики
-----------------------

ZeppOS (насколько известно на данный момент) следующие форматы графики
ID        Кол-во цветов      Файлы          Примечания
TGA-32    много              *.rgba.png     Полноценный RGBA, без сжатия вообще
TGA-16    65K                *.rgb.png      16-ти битный RGB, без прозрачности
TGA-RLP   256                *.rlp.png      Палитра со сжатием, нельзя поворачивать через angle
TGA-P     256                *.p.png        Стандартный формат, палитра

Первый столбец - внутренний id программы.
Формат для конвертации отдельного файла определяется из его имени, соответствуя столбцу "Файлы".
Например, файл bg.rgb.png будет сохранён в RGB режиме, а overlay.rlp.png - в сжатой палитре.
В случае, если имя файла не содержит формат, будет использован формат по умолчанию: TGA-P (меняется
в файле настроек). Также формат файлов определяется по названию папки, в которой они лежат. То есть,
если папка называется 'animation.rgba', то вся графика внутри неё будет преобразована без потерь.

Чуть подробнее о графике:
- Форматы TGA-P и TGA-RLP ограничены 256 цветами на одной картинке. Цвета могут использоваться
  любые, но не более 256 различных (цвета с разной прозрачностью - разные цвета)
- TGA-16 не имеет ограничение на количество цветов, однако сам цвет ограничен пятью битами на
  канал. ВАЖНО: при конвертации в этот формат не создаётся бэкап оригинала
- TGA-32 просто сохраняет всё как есть. Картинки будут весить много, зато совершенно не потеряют в
  цвете и качестве

Сборка циферблата
-------------------

Порядок действий:
- 1. Конвертируется вся графика под формат браслета (в отдельной папке, оригиналы не
     перезаписывается)
- 2. (при желании) Соберёт файлы-исходники в один файл. То есть, если в папке циферблата есть
     папки lib и src, то все js-файлы из них будут собраны в один. Делается это для того,
     чтобы большие проекты можно было более-менее по-человечески разделить на части. Файлы из
     lib подключатся первыми, затем файлы из src. Если же в папке циферблата уже есть папка
     watchface, этот шаг пропускается.
- 3. (при желании) Сожмёт полученный скрипт через uglifyjs или esbuild, выбранный препроцессор
     должен быть установлен и вынесен в PATH. Включается в файле настроек.
- 4. (при желании) Создаст превью для циферблата, положит в dist. Требует zepp-player,
     установленный силой nodejs, консольная версия. Включается в файле настроек.
- 5. (при желании) Добавит уменьшенный файл preview.png в папку assets, включается
     в файле настроек.
- 6. Создаст bin-файл, положит его в папку dist. Добавит туда же файл infos.xml
- 7. Упакует всё что требуется для установки циферблата в zip архив, готовый для публикации
- 8. (при желании) Автоматически добавит полученный циферблат в Zepp Life на телефоне.
     Требует ADB, включается в настройках.


Файл настроек
---------------

Называется config.json, лежит в папке data рядом с программой.
Описание параметров:
- def_format - формат для конвертации по умолчанию, см список выше
- with_uglifyjs - если установлен в true, программа будет сжимать скрипты из src через uglifyjs
- uglifyjs_params - параметры командной строки для uglifyjs
- esbuild - если установлен в true, программа прогонит скрипты через esbuild. Да прибудут с тобой
  импорты и прочие вкусности пре-процессинга. Требуется установленный ESBuild.
- esbuild_params - доп. параметры командной строки для esbuild
- mk_preview - если установлен в true, при сборке будет создано превью циферблата с помощью
  zepp-preview
- add_preview_asset - если установлен в true, скопирует уменьшенное превью в assets.
- adb_install - если установлен в true, циферблат после сборки будет автоматически загружен на
  ваш телефон. Требуется включить adb.
- adb_path - папка на устройстве, в которую будет выгружен циферблат

Установка дополнительных компонентов.
----------------------------------------

Для работы некоторых функций программы, таких как компиляция через esbuild или сжатие через
uglifyjs, требуется установить несколько дополнительных программ.

- ESBuild. Система сборки для JavaScript. Предварительно установите NodeJS, после чего выполните
  команду `npm i -g esbuild` (в Linux её нужно выполнять от root пользователя)
- UglifyJS. Сжатие кода на JavaScript. Также установите NodeJS, после чего выполните команду
  `npm i -g uglify-js`
